---
title: "NextAuth.js"
"og:title": "NextAuth.js Lead Tracking – Dub Conversions"
description: "Learn how to track a lead conversion event with NextAuth.js and the Dub SDK"
---

import InstallTypescript from "/snippets/sdk-install-ts.mdx";
import InstallDubAnalytics from "/snippets/dub-analytics-install.mdx";

## Prerequisites

First, install the [`@dub/analytics` package](/sdks/js-client/overview) to your frontend code.

<Accordion title="Install the Dub Analytics package">
  <InstallDubAnalytics />
</Accordion>

Then, add the [Dub TypeScript SDK](/sdks/typescript/overview) to your backend code.

<Accordion title="Install the Dub TypeScript SDK">
  <InstallTypescript />
</Accordion>

## Configure NextAuth.js Options

Then, set up your NextAuth.js configuration options to track a lead conversion event using the `dub` TypeScript SDK.

Here's how it works in a nutshell:

1. Use NextAuth's [`signIn` event](https://next-auth.js.org/configuration/events#signin) to detect when there's a new sign up.
2. If the user is a new sign up, check if the `dclid` cookie is present.
3. If the `dclid` cookie is present, send a lead event to Dub using `dub.track.lead`
4. Delete the `dclid` cookie.

```typescript app/api/auth/[...nextauth]/options.ts
import { NextAuthOptions } from "next-auth";
import { cookies } from "next/headers";
import { dub } from "@/lib/dub";

export const authOptions: NextAuthOptions = {
  ...otherAuthOptions, // your other NextAuth options
  events: {
    async signIn(message) {
      // if it's a new sign up
      if (message.isNewUser) {
        // check if dclid cookie is present
        const clickId = cookies().get("dclid")?.value;
        if (clickId) {
          // send lead event to Dub
          await dub.track.lead({
            clickId,
            eventName: "Sign Up",
            customerId: user.id,
            customerName: user.name,
            customerEmail: user.email,
            customerAvatar: user.image,
          });
          // delete the dclid cookie
          cookies().set("dclid", "", {
            expires: new Date(0),
          });
        }
      }
    },
  },
};
```

Here's the full list of attributes you can pass when sending a lead event:

| Property         | Description                                                                                                              | Required |
| :--------------- | :----------------------------------------------------------------------------------------------------------------------- | :------- |
| `clickId`        | The unique `dclid` parameter that the lead conversion event is attributed to.                                            | Yes      |
| `eventName`      | The name of the event. Example: "Sign up".                                                                               | Yes      |
| `customerId`     | The unique ID of the customer in your system. Will be used to identify and attribute all future events to this customer. | Yes      |
| `customerEmail`  | The email address of the customer. If not passed, a random email address will be generated.                              | No       |
| `customerName`   | The name of the customer. If not passed, a random name will be generated (e.g. "Big Red Caribou").                       | No       |
| `customerAvatar` | The avatar URL of the customer. If not passed, a random avatar URL will be generated.                                    | No       |

## Create a NextAuth.js Route Handler

Finally, import the `authOptions` variable you created earlier and use `NextAuth` to create a handler for your NextAuth.js routes.

```typescript app/api/auth/[...nextauth]/index.ts
import { authOptions } from "./options";
import NextAuth from "next-auth";

const handler = NextAuth(authOptions);

export { handler as GET, handler as POST };
```
